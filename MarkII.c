#pragma config(Sensor, dgtl10, ballIntake,     sensorTouch)
#pragma config(Sensor, dgtl11, leftCatapult,   sensorTouch)
#pragma config(Sensor, dgtl12, rightCatapult,  sensorTouch)
#pragma config(Motor,  port1,           leftWheel1,    tmotorVex393TurboSpeed_HBridge, openLoop)
#pragma config(Motor,  port2,           leftWheel2,    tmotorVex393TurboSpeed_MC29, openLoop)
#pragma config(Motor,  port3,           rightWheel1,   tmotorVex393TurboSpeed_MC29, openLoop, reversed)
#pragma config(Motor,  port4,           catapult1,     tmotorVex393HighSpeed_MC29, openLoop)
#pragma config(Motor,  port5,           rightWheel3,   tmotorVex393TurboSpeed_MC29, openLoop, reversed)
#pragma config(Motor,  port6,           catapult2,     tmotorVex393HighSpeed_MC29, openLoop, reversed)
#pragma config(Motor,  port7,           rightWheel2,   tmotorVex393TurboSpeed_MC29, openLoop, reversed)
#pragma config(Motor,  port8,           leftWheel3,    tmotorVex393TurboSpeed_MC29, openLoop)
#pragma config(Motor,  port9,           catapult3,     tmotorVex393HighSpeed_MC29, openLoop)
#pragma config(Motor,  port10,          intake,        tmotorVex393TurboSpeed_HBridge, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#pragma platform(VEX)

//Competition Control and Duration Settings
#pragma competitionControl(Competition)

#include "Vex_Competition_Includes.c"   //Main competition background code...do not modify!

/** Sets the speeds of all the left wheels. **/
void setLeftWheelSpeed (int speed) {
  motor[leftWheel1]   = speed;
  motor[leftWheel2]   = speed;
  motor[leftWheel3]   = speed;
}

/** Sets the speeds of all the right wheels. **/
void setRightWheelSpeed (int speed) {
  motor[rightWheel1]  = speed;
  motor[rightWheel2]  = speed;
  motor[rightWheel3]  = speed;
}

/** Sets the speeds of all wheels. **/
void setWheelSpeeds (int left, int right) {
  setLeftWheelSpeed(left);
  setRightWheelSpeed(right);
}

//2 inv
/** Sets all the catapult motors. **/
void setCatapultSpeed (int speed) {
  motor[catapult1]     = speed;
  motor[catapult2]     = speed;
  motor[catapult3]     = speed;
}

/** Controlls the drivebase. **/
void tankDrive () {

  //left wheels
  if(abs(vexRT(Ch3))<10) //deadbands
    setLeftWheelSpeed(0);
  else
    setLeftWheelSpeed(vexRT(Ch3));

  //right wheels
  if(abs(vexRT(Ch2))<10) //deadbands
    setRightWheelSpeed(0);
  else
    setRightWheelSpeed(vexRT(Ch2));
}

/** Controlls the intake for balls. Currently not toggle, can easialy be. **/
void intakeControl() {
  if(VexRT(Btn5U))
    motor[intake] = 127;
  else if(VexRT(Btn5D))
    motor[intake] = -127;
  else
    motor[intake] = 0;
}

/** Pre autonomous task (who actually uses this?).
May put in some pretty flashing indicator lights **/
void pre_auton() {
  bStopTasksBetweenModes = true;

}

/** Controlls the cataptult for regular field use **/
int catapultDelay = 150; //delay for cycle to start reading sensor
int catapultHoldPower = 20; //Power to keep catapult in same place - was 15

task primeCatapult () {
	while(!SensorValue[rightCatapult]) {
  	setCatapultSpeed(127);
  	wait1Msec(30);
  }
  setCatapultSpeed(catapultHoldPower);
  stopTask(primeCatapult);
}

task catapultKick() {
  while(true) {
    if(VexRT(Btn6U)) {
    	stopTask(primeCatapult);
      setCatapultSpeed(127);
      wait1Msec(catapultDelay); //May not need
      setCatapultSpeed(0);
    }
    wait1Msec(30);
  }
}

/** Controlls the catapult for driver loads and autonomous **/
int ballLoadDelay = 1000; //Delay for the ball to be loaded by human driver.
task catapultKickUserLoad() {
  while(true) {
    setCatapultSpeed(127);
    wait1Msec(catapultDelay); //May not need
    while(!SensorValue[rightCatapult] && !SensorValue[leftCatapult])
      setCatapultSpeed(127);
    setCatapultSpeed(catapultHoldPower);
  wait1Msec(ballLoadDelay);
  }
}

/** Autonomous task - 15 seconds **/
task autonomous() {
  ClearTimer(T1);
  startTask(catapultKickUserLoad);
  while(time1[T1]<5000) {}
  stopTask(catapultKickUserLoad);
  setWheelSpeeds(127,127);
  wait1Msec(1100);
  setWheelSpeeds(0,0);
}

/*
ch3               = run all right side motors
ch2               = run all left side motors
Btn5U             = 127 intake
Btn5D             = -127 intake
Btn6U tapped      = run catapults once in a cycle
Btn6U holded down = full auto
Btn8D             = run driver load shooter (basically full auto) - donâ€™t have to run intake
Btn8U             = stop driver load shooter
Btn7D             = auto align with gyro (not necessary yet)
*/
/** Usercontrol task **/
task usercontrol() {
	startTask(catapultKick);
  while (true) {
    if(VexRT(Btn8D))
      startTask(catapultKickUserLoad);
    else if(VexRT(Btn8U))
      stopTask(catapultKickUserLoad);


    if(SensorValue[ballIntake] && !VexRT(Btn6U))
    	startTask(primeCatapult);

    //Add Gyro - 7D

    tankDrive();

    intakeControl();

    //Anywhere from 25-50 Msec pause to prevent cortex overload
    wait1Msec(30);
  }
}
